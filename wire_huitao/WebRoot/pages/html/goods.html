<!DOCTYPE html >
<html >
<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>惠淘无线</title>
<meta name="viewport" content="initial-scale=1, maximum-scale=1">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="stylesheet" href="http://g.alicdn.com/msui/sm/0.6.2/css/sm.css">
<link rel="stylesheet" href="http://g.alicdn.com/msui/sm/0.6.2/css/sm-extend.css">
<link rel="stylesheet" href="../css/iconfont.css" >
<link rel="stylesheet" href="../css/mycss.css" >
<script type='text/javascript' src='http://g.alicdn.com/sj/lib/zepto/zepto.js' charset='utf-8'></script>

</head>

<body>

<div class="page  external" id="timelimit">
      <header class="bar bar-nav">
        <a class="button button-link button-nav pull-left" href="/demos/card" data-transition='slide-out'>
          <span class="icon icon-left"></span>
          返回
        </a>
        <a class="button button-link button-nav pull-right" href="/demos/card" data-transition='slide-out'>
          <span class="icon iconfont icon-close"></span>
        </a>
        <a class="button button-link button-nav pull-right" href="/demos/card" data-transition='slide-out'>
          <span class="icon icon-refresh"></span>  
        </a>
     
        <h1 class="title">活动宝贝</h1>
      </header>
      <nav class="bar bar-tab">
        <a class="tab-item active selectcolor tab-font bartab1" href="#alltime" external>
         
          <span class="tab-label">返回</span>
        </a>
        <a class="tab-item tab-font sgoods-select-all  bartab1" href="javascript:void()" external>
         
          <span class="tab-label">全选</span>
        </a>
 		<a class="tab-item tab-font bartab1" href="" external >
         
          <span class="tab-label">取消展示</span>
        </a>
        <a class="tab-item active selectcolor tab-font bartab2" href="#alltime" external>
         
          <span class="tab-label">返回</span>
        </a>
        <a class="tab-item tab-font goods-select-all bartab2" href="javascript:void()" external>
         
          <span class="tab-label">全选</span>
        </a>
 		<a class="tab-item tab-font bartab2 addrecgoods" href="javascript:void()"  external >
         
          <span class="tab-label">添加展示</span>
        </a>
      </nav>
      <div class="content ">
  <div class="buttons-tab backgroundzindex">
    <a href="#tab1" class="tab-link active button">已选择</a>
    <a href="#tab2" class="tab-link  button">出售中</a>
    
  </div>
  <div class="content-block margin0padding0 ">
    <div class="tabs">
      <div id="tab1" class="tab active tab1">
        <div class="content margin0padding0">
          
          <div class="list-block goods-list media-list ">
            <ul >
             <li>
                <label class="label-checkbox item-content">
                  <input type="checkbox" name="my-radio" >
                  <div class="item-media"><i class="icon icon-form-checkbox"></i></div>
                  <div class="item-inner marginleft0">
                    <ul class='margin0padding0 list-block '>
                    <li>
                        <a href="#" class=" item-content">
                      <div class="item-media"><img src="http://gqianniu.alicdn.com/bao/uploaded/i4//tfscom/i3/TB10LfcHFXXXXXKXpXXXXXXXXXX_!!0-item_pic.jpg_250x250q60.jpg" style='width: 4rem;'></div>
                      <div class="item-inner">
                        <div class="item-title-row">
                          <div class="item-title"></div>
                          <div class="item-after fontsize75">库存：294</div>
                        </div>
                        
                        <div class="item-text">AJ16夏装新品 男士修身翻领纯色短袖T恤衫 休闲英伦修身T恤 男短T</div>
                        <div class="item-subtitle redcolor">￥19.00</div>
                      </div>
                    </a>
                  </li>
                  <li class='item-content'>
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner displaycss">
                      <div class="item-title label">商品原价</div>
                      <div class="item-input"><input type="text" placeholder="活动名称"></div>
                    </div>
                  </li>
                  <li class="item-content">
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner displaycss">
                      <div class="item-title label">折扣价格</div>
                      <div class="item-input"><input type="text" placeholder="活动名称"></div>
                    </div>
                  </li>
                  <li class="item-content">
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner displaycss">
                      <div class="item-title label">限购数量</div>
                      <div class="item-input"><input type="text" placeholder="1件"></div>

                    </div>
                  </li>
                  <li class="item-content">
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner displaycss">
                      
                       <div class="item-title label"></div>
                      <div class="item-after"><p class="buttons-row"><a href="http://www.baidu.com" class="button active">取消主推</a><a href="#" class="button">置成售罄</a></p></div>
                    </div>
                  </li>
                    </ul>
                  </div>
                </label>
              </li>
              <li>
                <label class="label-checkbox item-content">
                  <input type="checkbox" name="my-radio">
                  <div class="item-media"><i class="icon icon-form-checkbox"></i></div>
                  <div class="item-inner marginleft0">
                    <ul class='margin0padding0 list-block'>
                    <li>
                        <a href="#" class=" item-content">
                      <div class="item-media"><img src="http://gqianniu.alicdn.com/bao/uploaded/i4//tfscom/i3/TB10LfcHFXXXXXKXpXXXXXXXXXX_!!0-item_pic.jpg_250x250q60.jpg" style='width: 4rem;'></div>
                      <div class="item-inner">
                        <div class="item-title-row">
                          <div class="item-title"></div>
                          <div class="item-after fontsize75">库存：294</div>
                        </div>
                        
                        <div class="item-text">AJ16夏装新品 男士修身翻领纯色短袖T恤衫 休闲英伦修身T恤 男短T</div>
                        <div class="item-subtitle redcolor">￥19.00</div>
                      </div>
                    </a>
                  </li>
                  <li class='item-content'>
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner displaycss">
                      <div class="item-title label">商品原价</div>
                      <div class="item-input"><input type="text" placeholder="商品原价"></div>
                    </div>
                  </li>
                  <li class="item-content">
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner displaycss">
                      <div class="item-title label">折扣价格</div>
                      <div class="item-input"><input type="text" placeholder="折扣价格"></div>
                    </div>
                  </li>
                  <li class="item-content">
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner displaycss">
                      <div class="item-title label">限购数量</div>
                      <div class="item-input"><input type="text" placeholder="1件"></div>
                      
                    </div>
                  </li>
                  <li class="item-content">
                    <div class="item-media"><i class="icon icon-f7"></i></div>
                    <div class="item-inner displaycss">
                      
                       <div class="item-title label"></div>
                      <div class="item-after"><p class="buttons-row"><a href="http://www.baidu.com" class="button active">取消主推</a><a href="#" class="button">置成售罄</a></p></div>
                    </div>
                  </li>
                    </ul>
                  </div>
                </label>
              </li>
             
            </ul>
          </div>
        </div>
      </div>
      <div id="tab2" class="tab  tab2">
        <div class="content-block margin0padding0 " data-distance="60">
        
        <div class="bar bar-header-secondary">
          <div class="searchbar">
            <a class="searchbar-cancel">取消</a>
            <div class="search-input">
              <label class="icon icon-search" for="search"></label>
              <input type="search" id='search' placeholder='输入关键字...'/>
            </div>
          </div>
        </div>
<div class="content   infinite-scroll infinite-scroll-bottom">

      <div class="list-block media-list pull-to-refresh-content">
        <div class="pull-to-refresh-layer">
            <div class="preloader"></div>
            <div class="pull-to-refresh-arrow"></div>
        </div>
          <ul class="goods-list ">

                
                    </ul>
                  </div>
                </label>
              </li>
            </ul>
            </div>
            <div class="infinite-scroll-preloader">
              <div class="preloader"></div>
          </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
    

<!--调试引用-->


<script type='text/javascript' src='http://g.alicdn.com/msui/sm/0.6.2/js/sm.js' charset='utf-8'></script>

<script type='text/javascript' src='http://g.alicdn.com/msui/sm/0.6.2/js/sm-extend.js' charset='utf-8'></script>
<script type="text/javascript" src="../js/apitoserver.js"></script>
<script type="text/javascript" src="../js/common.js"></script>
<script>
	$('.addrecgoods').on('click',function(){
		//var inputobj=$('.tab2 .goods-list input[checked=true]');
		var tobj=$('.tab2 .goods-list input[type=checkbox]')
		console.log(tobj.length);
		var gettrue=[];
		for(var i=0,l=tobj.length;i<l;i++){
			console.log($(tobj[i]).prop('checked'));
			if($(tobj[i]).prop('checked')==true){
				gettrue.push(tobj[i].value);
			}
		}
		console.log(gettrue,gdata);
		var seedgoodslist=[];
        if(gettrue.length==0){
        	$.toast("请先选择商品！");
        }
		for(var i in gdata){
			var cobj={
                 "actDetailId": "", 
                 "activityPrice": "", 
                 "currentNum": "", 
                 "detailUrl": "", 
                 "isSaleOut": "", 
                 "oldNum": "", 
                 "overWay": "", 
                 "pic_url": "", 
                 "price": "", 
                 "title": "", 
                 "type": "1", 
                 "useroperation": "add"
             }
			var tmpcobj=gdata[i]
			var numIid=tmpcobj.numIid;
			console.log('numIid',numIid);
			var res=$.inArray(''+numIid,gettrue);
			console.log('res',res);
			if(res>-1){
				cobj.activityPrice=tmpcobj.price;
				cobj.price=tmpcobj.price;
				cobj.title=tmpcobj.title;
				cobj.pic_url=tmpcobj.picUrl;
				cobj.oldNum=tmpcobj.num;
				seedgoodslist.push(cobj);
			}
			
		}
		console.log('seedgoodslist',seedgoodslist);
		
		
	})
	$('.bartab2').hide();
	$('.tab-link').on('click',function(e){
	console.log(e);
	var vherf=$(this).attr('href');
	if(vherf=='#tab1'){
		$('.bartab1').css('display','table-cell');
		$('.bartab2').hide();
	}else{
		$('.bartab2').css('display','table-cell');
		$('.bartab1').hide();
	}
	});
	$('.goods-select-all').on('click',function(){
		var inputobj=$('.tab2 .goods-list input[type=checkbox]');
		console.log(inputobj.attr("checked"),inputobj.attr("checked")=='true');
		if(inputobj.prop("checked")==true){
			inputobj.prop("checked",'');
			$(this).find('span').html('全选')
		}else{
			inputobj.prop('checked','true');
			$(this).find('span').html('取消全选')
		}
	})
	$('.sgoods-select-all').on('click',function(){
		var inputobj=$('.tab1 .goods-list input[type=checkbox]');
		console.log(inputobj.attr("checked"),inputobj.attr("checked")=='true');
		if(inputobj.prop("checked")==true){
			inputobj.prop("checked",'');
			$(this).find('span').html('全选')
		}else{
			inputobj.attr('checked',true);
			$(this).find('span').html('取消全选')
		}
	})
	  var gdata=[];
	  var loading = false;
      // 最多可加载的条目
      var maxItems = 100;

      // 每次加载添加多少条目
      var itemsPerLoad = 10;
      var curpagenum = 1;
	$(document).on('refresh', '.pull-to-refresh-content',function(e) {
    // 模拟2s的加载过程
    setTimeout(function() {
     var upobj=$(e.target).find('.goods-list');
     		  var html = '';
              var params1={
					'pageSize':10,
					'pageNo':1,
					 fields:'approve_status,num_iid,title,nick,type,cid,pic_url,num,props,valid_thru,list_time,price,has_discount,has_invoice,has_warranty,has_showcase,modified,delist_time,postage_id,seller_cids,outer_id,sold_quantity' 
				}
				API.base('/sys/items!searchItemOnsale.action', params1, function(rsp){
				console.log(rsp);
				if(rsp.success==true){
				    curpagenum++;
					var data=rsp.data;
					var totalr=data.total_results;
					var gitems=data.items;
					maxItems=totalr;
					console.log('gitems',gitems);
					Array.prototype.push.apply(gdata, gitems);  
					console.log('gitems',gitems);
					for(var i=0;i<totalr;i++){
						var timec=new Date().valueOf()
					 	console.log('i',i,gitems[i].listTime);
					 	var downtime=gitems[i].listTime.time+604800
					 	var havetime=downtime-timec;
					 	var hday=Math.floor(havetime/86400);
					 	var hhours=Math.floor((havetime-hday*86400)/3600)
					 	var hminuts=Math.floor((havetime-hday*86400-hhours*3600)/60)
					 	var hsecond=havetime%60
					 	var timestr='离下架'+hday+'天'+hhours+'小时'+hminuts+'分'+hsecond+'秒';
			 			html += '<li>'+
			                '<label class="label-checkbox item-content ">'+
			                 ' <input type="checkbox" name="numIid" value='+gitems[i].numIid+'>'+
			                  '<div class="item-media"><i class="icon icon-form-checkbox"></i></div>'+
			                  '<div class="item-inner marginleft0">'+
			                   ' <ul class="margin0padding0 list-block">'+
			                   ' <li>'+
			                    '    <a href="#" class="item-link item-content">'+
			                     ' <div class="item-media"><img src="'+gitems[i].picUrl+'" style="width: 4rem;"></div>'+
			                      '<div class="item-inner noline">'+
			                       ' <div class="item-title-row">'+
			                        '  <div class="item-title"></div>'+
			                         ' <div class="item-after tipinfo">库存：'+gitems[i].num+'</div>'+
			                        '</div>'+
			                       ' <div class="item-text">'+gitems[i].title+'</div>'+
			                        '<div class="item-subtitle "></div>'+
			                        '<div class="item-title-row">'+
			                         ' <div class="item-title redcolor">￥'+gitems[i].price+'</div>'+
			                          '<div class="item-after fontsize5">'+timestr+'</div>'+
			                        '</div>'+
			                      '</div>'+
			                    '</a>'+
			                  '</li>'+
			                    '</ul>'+
			                  '</div>'+
			                '</label>'+
			              '</li>';
					}
					upobj.html(html);
				}else{
					$.toast("请求服务器超时！");
				}
			});
      
        // 加载完毕需要重置
        $.pullToRefreshDone('.pull-to-refresh-content');
    }, 2000);
});



	
      function addItems(number, lastIndex) {
              // 生成新条目的HTML
              var html = '';
              var params1={
					'pageSize':itemsPerLoad,
					'pageNo':curpagenum,
					 fields:'approve_status,num_iid,title,nick,type,cid,pic_url,num,props,valid_thru,list_time,price,has_discount,has_invoice,has_warranty,has_showcase,modified,delist_time,postage_id,seller_cids,outer_id,sold_quantity' 
				}
				API.base('/sys/items!searchItemOnsale.action', params1, function(rsp){
				console.log(rsp);
				if(rsp.success==true){
				    curpagenum++;
				   
					var data=rsp.data;
					var totalr=data.total_results;
					var gitems=data.items;
					maxItems=totalr;
				
					Array.prototype.push.apply(gdata, gitems);  
					var timec=new Date().valueOf()
					for(var i=0;i<totalr;i++){
						
					 	console.log('i',i,gitems[i].listTime);
					 	var downtime=gitems[i].listTime.time+604800000
					 	
					 	var havetime=downtime-timec;
					 	console.log(downtime,timec,havetime);
					 	var hday=Math.floor(havetime/86400000);
					 	var hhours=Math.floor((havetime-hday*86400000)/3600000)
					 	var hminuts=Math.floor((havetime-hday*86400000-hhours*3600000)/60000)
					 	var hsecond=Math.round((havetime/1000)%60,0)
					 	var timestr='离下架'+hday+'天'+hhours+'小时'+hminuts+'分'+hsecond+'秒';
			 			html += '<li>'+
			                '<label class="label-checkbox item-content ">'+
			                 ' <input type="checkbox" name="numIid" value='+gitems[i].numIid+'>'+
			                  '<div class="item-media"><i class="icon icon-form-checkbox"></i></div>'+
			                  '<div class="item-inner marginleft0">'+
			                   ' <ul class="margin0padding0 list-block">'+
			                   ' <li>'+
			                    '    <a href="#" class="item-link item-content">'+
			                     ' <div class="item-media"><img src="'+gitems[i].picUrl+'" style="width: 4rem;"></div>'+
			                      '<div class="item-inner noline">'+
			                       ' <div class="item-title-row">'+
			                        '  <div class="item-title"></div>'+
			                         ' <div class="item-after tipinfo">库存：'+gitems[i].num+'</div>'+
			                        '</div>'+
			                       ' <div class="item-text">'+gitems[i].title+'</div>'+
			                        '<div class="item-subtitle "></div>'+
			                        '<div class="item-title-row">'+
			                         ' <div class="item-title redcolor">￥'+gitems[i].price+'</div>'+
			                          '<div class="item-after fontsize5">'+timestr+'</div>'+
			                        '</div>'+
			                      '</div>'+
			                    '</a>'+
			                  '</li>'+
			                    '</ul>'+
			                  '</div>'+
			                '</label>'+
			              '</li>';
					}
					$('.infinite-scroll-bottom .goods-list').append(html); 
				}else{
				$.toast("请求服务器超时！");
				}
			});
              
              

          }
          
      addItems(itemsPerLoad, 0);

      // 上次加载的序号

      var lastIndex = 10;

      // 注册'infinite'事件处理函数
      $(document).on('infinite', '.infinite-scroll-bottom',function() {

          // 如果正在加载，则退出
          if (loading) return;

          // 设置flag
          loading = true;

          // 模拟1s的加载过程
          setTimeout(function() {
              // 重置加载flag
              loading = false;

              if (lastIndex >= maxItems) {
                  // 加载完毕，则注销无限加载事件，以防不必要的加载
                  $.detachInfiniteScroll($('.infinite-scroll'));
                  // 删除加载提示符
                  $('.infinite-scroll-preloader').remove();
                  return;
              }

              // 添加新条目
			  
              addItems(itemsPerLoad, lastIndex);
              // 更新最后加载的序号
              lastIndex = $('.goods-list>li').length;
              //容器发生改变,如果是js滚动，需要刷新滚动
              $.refreshScroller();
          }, 1000);
      });
    $.init();
	$.attachInfiniteScroll($('.infinite-scroll'))
	

	
</script>
</body>
</html>
